<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-3xl font-bold text-textMain">Therapist Applications</h1>
      <p class="text-gray-600 mt-2">Review and manage therapist applications</p>
    </div>
    <a href="/admin" class="btn-secondary">
      <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
    </a>
  </div>

  <% if (applications && applications.length > 0) { %>
    <!-- Status Filter Tabs -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
      <div class="border-b border-gray-200">
        <nav class="flex space-x-8 px-6" aria-label="Tabs">
          <button class="status-tab active border-b-2 border-primary text-primary py-4 px-1 text-sm font-medium" data-status="all">
            All Applications (<%= applications.length %>)
          </button>
          <button class="status-tab border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-4 px-1 text-sm font-medium" data-status="pending">
            Pending (<%= applications.filter(app => app.status === 'pending').length %>)
          </button>
          <button class="status-tab border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-4 px-1 text-sm font-medium" data-status="approved">
            Approved (<%= applications.filter(app => app.status === 'approved').length %>)
          </button>
          <button class="status-tab border-b-2 border-transparent text-gray-500 hover:text-gray-700 py-4 px-1 text-sm font-medium" data-status="rejected">
            Rejected (<%= applications.filter(app => app.status === 'rejected').length %>)
          </button>
        </nav>
      </div>
    </div>

    <!-- Applications List -->
    <div class="space-y-4">
      <% applications.forEach(application => { %>
        <div class="application-card bg-white rounded-lg shadow-sm border border-gray-200 p-6" data-status="<%= application.status %>">
          <div class="flex items-start justify-between">
            <div class="flex items-start space-x-4">
              <!-- Profile Image -->
              <div class="flex-shrink-0">
                <% if (application.profile_image) { %>
                  <img src="/uploads/<%= application.profile_image %>" 
                       alt="<%= application.name %>'s Profile" 
                       class="w-16 h-16 rounded-full object-cover border-2 border-gray-200">
                <% } else { %>
                  <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center">
                    <i class="fas fa-user text-gray-400 text-xl"></i>
                  </div>
                <% } %>
              </div>
              
              <!-- Application Info -->
              <div class="flex-1">
                <div class="flex items-center space-x-3 mb-2">
                  <h3 class="text-lg font-semibold text-gray-900"><%= application.name %></h3>
                  <span class="status-badge status-<%= application.status %>">
                    <% if (application.status === 'pending') { %>
                      <i class="fas fa-clock mr-1"></i>Pending
                    <% } else if (application.status === 'approved') { %>
                      <i class="fas fa-check-circle mr-1"></i>Approved
                    <% } else if (application.status === 'rejected') { %>
                      <i class="fas fa-times-circle mr-1"></i>Rejected
                    <% } %>
                  </span>
                </div>
                
                <p class="text-gray-600 mb-2">
                  <i class="fas fa-envelope mr-2"></i><%= application.email %>
                </p>
                
                <% if (application.specialty) { %>
                  <p class="text-gray-600 mb-2">
                    <i class="fas fa-stethoscope mr-2"></i><%= application.specialty %>
                  </p>
                <% } %>
                
                <% if (application.experience) { %>
                  <p class="text-gray-600 mb-3">
                    <i class="fas fa-briefcase mr-2"></i><%= application.experience %>
                  </p>
                <% } %>
                
                <% if (application.bio) { %>
                  <p class="text-gray-700 text-sm mb-3 line-clamp-2"><%= application.bio %></p>
                <% } %>
                
                <div class="flex items-center space-x-4 text-sm text-gray-500">
                  <span>
                    <i class="fas fa-calendar mr-1"></i>
                    Applied: <%= new Date(application.created_at).toLocaleDateString() %>
                  </span>
                  <% if (application.updated_at && application.updated_at !== application.created_at) { %>
                    <span>
                      <i class="fas fa-edit mr-1"></i>
                      Updated: <%= new Date(application.updated_at).toLocaleDateString() %>
                    </span>
                  <% } %>
                </div>
              </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-col space-y-2">
              <a href="/admin/applications/<%= application.id %>" 
                 class="btn-primary text-sm px-4 py-2 text-center">
                <i class="fas fa-eye mr-1"></i>View Details
              </a>
              
              <% if (application.status === 'pending') { %>
                <!-- Quick Approve/Reject for Pending Applications -->
                <form method="POST" action="/admin/applications/<%= application.id %>/approve" class="inline">
                  <button type="submit" class="btn-success text-sm px-4 py-2 w-full">
                    <i class="fas fa-check mr-1"></i>Approve
                  </button>
                </form>
                
                <form method="POST" action="/admin/applications/<%= application.id %>/reject" class="inline">
                  <input type="hidden" name="reason" value="Application rejected">
                  <button type="submit" class="btn-danger text-sm px-4 py-2 w-full">
                    <i class="fas fa-times mr-1"></i>Reject
                  </button>
                </form>
              <% } %>
            </div>
          </div>
          
          <!-- Files Section -->
          <% if (application.resume_file || application.certification_file) { %>
            <div class="mt-4 pt-4 border-t border-gray-200">
              <h4 class="text-sm font-medium text-gray-900 mb-2">Uploaded Documents:</h4>
              <div class="flex space-x-4">
                <% if (application.resume_file) { %>
                  <a href="/uploads/<%= application.resume_file %>" 
                     target="_blank" 
                     class="inline-flex items-center px-3 py-1 bg-blue-50 text-blue-700 text-sm rounded-md hover:bg-blue-100">
                    <i class="fas fa-file-pdf mr-1"></i>Resume
                  </a>
                <% } %>
                <% if (application.certification_file) { %>
                  <a href="/uploads/<%= application.certification_file %>" 
                     target="_blank" 
                     class="inline-flex items-center px-3 py-1 bg-green-50 text-green-700 text-sm rounded-md hover:bg-green-100">
                    <i class="fas fa-certificate mr-1"></i>Certification
                  </a>
                <% } %>
              </div>
            </div>
          <% } %>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <!-- Empty State -->
    <div class="text-center py-12">
      <div class="mx-auto h-24 w-24 text-gray-400 mb-4">
        <i class="fas fa-file-medical text-6xl"></i>
      </div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No Applications Yet</h3>
      <p class="text-gray-600">No therapist applications have been submitted yet.</p>
    </div>
  <% } %>
</div>

<style>
.status-badge {
  @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium;
}

.status-pending {
  @apply bg-yellow-100 text-yellow-800;
}

.status-approved {
  @apply bg-green-100 text-green-800;
}

.status-rejected {
  @apply bg-red-100 text-red-800;
}

.btn-success {
  @apply bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 rounded-md font-medium transition-colors;
}

.btn-danger {
  @apply bg-red-600 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 rounded-md font-medium transition-colors;
}

.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.status-tab.active {
  @apply border-primary text-primary;
}
</style>

<script>
// Filter applications by status
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.querySelectorAll('.status-tab');
  const applications = document.querySelectorAll('.application-card');
  
  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      const status = this.getAttribute('data-status');
      
      // Update active tab
      tabs.forEach(t => {
        t.classList.remove('active', 'border-primary', 'text-primary');
        t.classList.add('border-transparent', 'text-gray-500');
      });
      this.classList.add('active', 'border-primary', 'text-primary');
      this.classList.remove('border-transparent', 'text-gray-500');
      
      // Filter applications
      applications.forEach(app => {
        if (status === 'all' || app.getAttribute('data-status') === status) {
          app.style.display = 'block';
        } else {
          app.style.display = 'none';
        }
      });
    });
  });
});
</script>