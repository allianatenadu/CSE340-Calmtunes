<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="mx-auto max-w-4xl">
    <!-- Welcome Header -->
    <h1 class="text-3xl font-bold tracking-tight text-foreground-light dark:text-foreground-dark mb-6">
      Welcome back, <%= user.name %>! ðŸŒ¿
    </h1>

    <!-- Daily Quote Section -->
    <div class="relative mb-8 overflow-hidden rounded-xl bg-cover bg-center p-6 sm:p-8 flex flex-col justify-end min-h-[280px]" style='background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0) 60%), url("https://lh3.googleusercontent.com/aida-public/AB6AXuCnbCtwGdxwAmankibvu2hEH8d4B9GAX8X3zcelWjACTRamyd0qtQkmX8c72BGrmDXfgwFFwvsinVAZ57CMJhbgvJoj0_rysYpijftXR8hTWso4n4oKfvdwtQKn2plw0vG8tZRyUiTHeL3pAPA0V8FDozciyvQa8zhN62suhPF8DYx5ZuYjoUpdHkheU1n7qgoKBqYK7jrR4odjy3yXwBRgXdtrl61JmiKnImEvT_M5qtWOkaHBX82gfLI_E7Aw6Y2oGHYTrvLmPiE");'>
      <div class="flex w-full flex-col items-start gap-4">
        <div class="max-w-md">
          <div class="flex items-center justify-between">
            <p class="text-2xl font-bold text-white">Quote of the Day</p>
            <button id="refresh-quote-btn" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-full transition-colors duration-200" title="Refresh Quote">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
              </svg>
            </button>
          </div>
          <div id="daily-quote-content" class="text-base font-medium text-white/90 mt-1">
            <!-- Quote content with small author images will be loaded here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions Section -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold tracking-tight text-foreground-light dark:text-foreground-dark mb-4">Quick Actions</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <a class="group block rounded-lg bg-card-light dark:bg-card-dark p-6 shadow-sm hover:shadow-lg transition-shadow duration-300" href="/mood-tracker">
          <h3 class="text-lg font-bold text-foreground-light dark:text-foreground-dark">Mood Check-in</h3>
          <p class="mt-1 text-sm text-subtle-foreground-light dark:text-subtle-foreground-dark">Log your current mood</p>
        </a>
        <a class="group block rounded-lg bg-card-light dark:bg-card-dark p-6 shadow-sm hover:shadow-lg transition-shadow duration-300" href="/music">
          <h3 class="text-lg font-bold text-foreground-light dark:text-foreground-dark">Music Therapy</h3>
          <p class="mt-1 text-sm text-subtle-foreground-light dark:text-subtle-foreground-dark">Listen to calming playlists</p>
        </a>
        <a class="group block rounded-lg bg-card-light dark:bg-card-dark p-6 shadow-sm hover:shadow-lg transition-shadow duration-300" href="/panic">
          <h3 class="text-lg font-bold text-foreground-light dark:text-foreground-dark">Panic Relief</h3>
          <p class="mt-1 text-sm text-subtle-foreground-light dark:text-subtle-foreground-dark">Guided breathing exercises</p>
        </a>
      </div>
    </section>

    <!-- Tools Section -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold tracking-tight text-foreground-light dark:text-foreground-dark mb-4">Tools</h2>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <a class="group block rounded-lg bg-card-light dark:bg-card-dark p-6 shadow-sm hover:shadow-lg transition-shadow duration-300" href="/drawing">
          <h3 class="text-lg font-bold text-foreground-light dark:text-foreground-dark">Art Therapy</h3>
          <p class="mt-1 text-sm text-subtle-foreground-light dark:text-subtle-foreground-dark">Creative expression</p>
        </a>
        <a class="group block rounded-lg bg-card-light dark:bg-card-dark p-6 shadow-sm hover:shadow-lg transition-shadow duration-300" href="/therapist/my-therapist">
          <h3 class="text-lg font-bold text-foreground-light dark:text-foreground-dark">My Therapist</h3>
          <p class="mt-1 text-sm text-subtle-foreground-light dark:text-subtle-foreground-dark">Connect with your therapist</p>
        </a>
        <a class="group block rounded-lg bg-primary p-6 shadow-sm hover:shadow-lg transition-shadow duration-300" href="/find-therapist">
          <h3 class="text-lg font-bold text-foreground-dark">Find Therapists</h3>
          <p class="mt-1 text-sm text-foreground-dark/80">Explore new therapists</p>
        </a>
      </div>
    </section>


    <!-- Recent Activity Section -->
    <section>
      <h2 class="text-2xl font-bold tracking-tight text-foreground-light dark:text-foreground-dark mb-4">Recent Activity</h2>
      <div class="relative flex flex-col gap-6">
        <% if (recentActivities && recentActivities.length > 0) { %>
          <% recentActivities.forEach((activity, index) => { %>
            <div class="timeline-item flex items-start gap-4">
              <div class="timeline-decorator relative">
                <div class="icon-circle <%= activity.type === 'mood' ? 'bg-primary/20 text-primary' :
                                        activity.type === 'music' ? 'bg-secondary/20 text-secondary' :
                                        activity.type === 'drawing' ? 'bg-purple-500/20 text-purple-500' :
                                        activity.type === 'panic' ? 'bg-accent/20 text-accent' :
                                        activity.type === 'activity' ? 'bg-blue-500/20 text-blue-500' :
                                        'bg-primary/20 text-primary' %>">
                  <% if (activity.type === 'mood') { %>
                    <svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
                      <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216ZM80,108a12,12,0,1,1,12,12A12,12,0,0,1,80,108Zm96,0a12,12,0,1,1-12-12A12,12,0,0,1,176,108Zm-1.07,48c-10.29,17.79-27.4,28-46.93,28s-36.63-10.2-46.92-28a8,8,0,1,1,13.84-8c7.47,12.91,19.21,20,33.08,20s25.61-7.1,33.07-20a8,8,0,0,1,13.86,8Z"></path>
                    </svg>
                  <% } else if (activity.type === 'music') { %>
                    <svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
                      <path d="M210.3,56.34l-80-24A8,8,0,0,0,120,40V148.26A48,48,0,1,0,136,184V98.75l69.7,20.91A8,8,0,0,0,216,112V64A8,8,0,0,0,210.3,56.34ZM88,216a32,32,0,1,1,32-32A32,32,0,0,1,88,216ZM200,101.25l-64-19.2V50.75L200,70Z"></path>
                    </svg>
                  <% } else if (activity.type === 'drawing') { %>
                    <svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
                      <path d="M200.77,53.89A103.27,103.27,0,0,0,128,24h-1.07A104,104,0,0,0,24,128c0,43,26.58,79.06,69.36,94.17A32,32,0,0,0,136,192a16,16,0,0,1,16-16h46.21a31.81,31.81,0,0,0,31.2-24.88,104.43,104.43,0,0,0,2.59-24A103.28,103.28,0,0,0,200.77,53.89Zm13,93.71A15.89,15.89,0,0,1,198.21,160H152a32,32,0,0,0-32,32,16,16,0,0,1-21.31,15.07C62.49,194.3,40,164,40,128a88,88,0,0,1,87.09-88h.9a88.35,88.35,0,0,1,88,87.25A88.86,88.86,0,0,1,213.81,147.6ZM140,76a12,12,0,1,1-12-12A12,12,0,0,1,140,76ZM96,100A12,12,0,1,1,84,88,12,12,0,0,1,96,100Zm0,56a12,12,0,1,1-12-12A12,12,0,0,1,96,156Zm88-56a12,12,0,1,1-12-12A12,12,0,0,1,184,100Z"></path>
                    </svg>
                  <% } else if (activity.type === 'panic') { %>
                    <svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
                      <path d="M221.8,175.94C216.25,166.38,208,139.33,208,104a80,80,0,1,0-160,0c0,35.34-8.26,62.38-13.81,71.94A16,16,0,0,0,48,200H88.81a40,40,0,0,0,78.38,0H208a16,16,0,0,0,13.8-24.06ZM128,216a24,24,0,0,1-22.62-16h45.24A24,24,0,0,1,128,216ZM48,184c7.7-13.24,16-43.92,16-80a64,64,0,1,1,128,0c0,36.05,8.28,66.73,16,80Z"></path>
                    </svg>
                  <% } else { %>
                    <svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
                      <path d="M200.77,53.89A103.27,103.27,0,0,0,128,24h-1.07A104,104,0,0,0,24,128c0,43,26.58,79.06,69.36,94.17A32,32,0,0,0,136,192a16,16,0,0,1,16-16h46.21a31.81,31.81,0,0,0,31.2-24.88,104.43,104.43,0,0,0,2.59-24A103.28,103.28,0,0,0,200.77,53.89Zm13,93.71A15.89,15.89,0,0,1,198.21,160H152a32,32,0,0,0-32,32,16,16,0,0,1-21.31,15.07C62.49,194.3,40,164,40,128a88,88,0,0,1,87.09-88h.9a88.35,88.35,0,0,1,88,87.25A88.86,88.86,0,0,1,213.81,147.6ZM140,76a12,12,0,1,1-12-12A12,12,0,0,1,140,76ZM96,100A12,12,0,1,1,84,88,12,12,0,0,1,96,100Zm0,56a12,12,0,1,1-12-12A12,12,0,0,1,96,156Zm88-56a12,12,0,1,1-12-12A12,12,0,0,1,184,100Z"></path>
                    </svg>
                  <% } %>
                </div>
              </div>
              <div class="flex-1 pt-1">
                <p class="font-medium text-foreground-light dark:text-foreground-dark"><%= activity.title %></p>
                <% if (activity.subtitle) { %>
                  <p class="text-sm text-subtle-foreground-light dark:text-subtle-foreground-dark"><%= activity.subtitle %></p>
                <% } %>
                <p class="text-sm text-subtle-foreground-light dark:text-subtle-foreground-dark">
                  <%= new Date(activity.date).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                  }) %>
                </p>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <div class="timeline-item flex items-start gap-4">
            <div class="timeline-decorator relative">
              <div class="icon-circle bg-primary/20 text-primary">
                <svg fill="currentColor" height="20px" viewBox="0 0 256 256" width="20px" xmlns="http://www.w3.org/2000/svg">
                  <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216ZM80,108a12,12,0,1,1,12,12A12,12,0,0,1,80,108Zm96,0a12,12,0,1,1-12-12A12,12,0,0,1,176,108Zm-1.07,48c-10.29,17.79-27.4,28-46.93,28s-36.63-10.2-46.92-28a8,8,0,1,1,13.84-8c7.47,12.91,19.21,20,33.08,20s25.61-7.1,33.07-20a8,8,0,0,1,13.86,8Z"></path>
                </svg>
              </div>
            </div>
            <div class="flex-1 pt-1">
              <p class="font-medium text-foreground-light dark:text-foreground-dark">Welcome to CalmTunes!</p>
              <p class="text-sm text-subtle-foreground-light dark:text-subtle-foreground-dark">Start your wellness journey</p>
            </div>
          </div>
        <% } %>
      </div>
    </section>
  </div>
</div>

<script src="/js/quotes.js"></script>
<script>
  // Initialize quotes on page load with proper alternating logic
  document.addEventListener('DOMContentLoaded', function() {
    const quoteContainer = document.getElementById('daily-quote-content');
    if (quoteContainer) {
      const lastAuthor = localStorage.getItem('lastQuoteAuthor');

      // FIXED: Proper alternating logic
      let authorQuotes;
      let nextAuthor;
      
      if (lastAuthor === 'steveharvey') {
        // Last was Steve, show Jim next
        authorQuotes = motivationalQuotes.jimRohn;
        nextAuthor = 'jimrohn';
      } else {
        // Last was Jim (or first time), show Steve next
        authorQuotes = motivationalQuotes.steveHarvey;
        nextAuthor = 'steveharvey';
      }

      const quote = authorQuotes[Math.floor(Math.random() * authorQuotes.length)];
      localStorage.setItem('lastQuoteAuthor', nextAuthor);

      let authorImage = "";
      if (quote.author === "Steve Harvey") {
        authorImage = "/images/Steve-Harvey.webp";
      } else if (quote.author === "Jim Rohn") {
        authorImage = "/images/Jim_rohn.jpg";
      }

      quoteContainer.innerHTML = `
        <div class="flex items-start gap-3 mt-2">
          <img src="${authorImage}" alt="${quote.author}" class="w-8 h-8 rounded-full object-cover flex-shrink-0" onerror="this.style.display='none'">
          <div class="flex-1">
            <p class="text-white/90 italic">"${quote.quote}"</p>
            <p class="text-white/70 text-sm mt-1">â€” ${quote.author}</p>
          </div>
        </div>
      `;
    }
    
    // Quote refresh functionality
    document.getElementById('refresh-quote-btn').addEventListener('click', function() {
      // Reuse the same alternating logic
      const quoteContainer = document.getElementById('daily-quote-content');
      if (quoteContainer) {
        const lastAuthor = localStorage.getItem('lastQuoteAuthor');

        let authorQuotes;
        let nextAuthor;
        
        if (lastAuthor === 'steveharvey') {
          authorQuotes = motivationalQuotes.jimRohn;
          nextAuthor = 'jimrohn';
        } else {
          authorQuotes = motivationalQuotes.steveHarvey;
          nextAuthor = 'steveharvey';
        }

        const quote = authorQuotes[Math.floor(Math.random() * authorQuotes.length)];
        localStorage.setItem('lastQuoteAuthor', nextAuthor);

        let authorImage = "";
        if (quote.author === "Steve Harvey") {
          authorImage = "/images/Steve-Harvey.webp";
        } else if (quote.author === "Jim Rohn") {
          authorImage = "/images/Jim_rohn.jpg";
        }

        quoteContainer.innerHTML = `
          <div class="flex items-start gap-3 mt-2">
            <img src="${authorImage}" alt="${quote.author}" class="w-8 h-8 rounded-full object-cover flex-shrink-0" onerror="this.style.display='none'">
            <div class="flex-1">
              <p class="text-white/90 italic">"${quote.quote}"</p>
              <p class="text-white/70 text-sm mt-1">â€” ${quote.author}</p>
            </div>
          </div>
        `;
      }
    });
  });
</script>