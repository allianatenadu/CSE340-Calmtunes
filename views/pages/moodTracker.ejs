<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl md:text-4xl font-bold text-textMain mb-4">📊 Mood Tracker</h1>
    <p class="text-xl text-gray-600">
      Monitor your emotional patterns and identify triggers to better understand your mental health journey
    </p>
  </div>

  <!-- Today's Mood Entry -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
    <!-- Mood Entry Form -->
    <div class="card">
      <h2 class="text-2xl font-bold text-textMain mb-6 flex items-center">
        <i class="fas fa-heart text-primary mr-3"></i> How are you feeling today?
      </h2>
      
      <form id="moodForm" action="/mood-tracker" method="POST" class="space-y-6">

        <!-- Mood selection -->
        <div>
          <label class="block text-sm font-medium text-textMain mb-3">Select your current mood:</label>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            <% const moods = ["Happy","Calm","Anxious","Sad","Angry","Neutral"]; %>
            <% const emojis = ["😊","😌","😰","😢","😠","😐"]; %>
            <% const colors = ["yellow","green","orange","blue","red","gray"]; %>
            <% moods.forEach((mood, i) => { %>
              <label class="mood-option cursor-pointer">
                <input type="radio" name="mood" value="<%= mood %>" class="sr-only mood-radio" required>
                <div class="mood-card p-4 rounded-lg border-2 border-gray-200 text-center transition-all duration-200 hover:border-<%= colors[i] %>-400 hover:bg-<%= colors[i] %>-50 transform hover:scale-105">
                  <div class="text-3xl mb-2"><%= emojis[i] %></div>
                  <div class="font-medium text-sm"><%= mood %></div>
                </div>
              </label>
            <% }) %>
          </div>
        </div>

        <!-- Energy slider -->
        <div>
          <label for="energy" class="block text-sm font-medium text-textMain mb-2">Energy Level (1-10):</label>
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-500">Low</span>
            <input type="range" id="energy" name="energy" min="1" max="10" value="5" class="flex-grow h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
            <span class="text-sm text-gray-500">High</span>
            <span id="energy-value" class="text-sm font-medium text-primary bg-primary/10 px-2 py-1 rounded">5</span>
          </div>
        </div>

        <!-- Notes -->
        <div>
          <label for="note" class="block text-sm font-medium text-textMain mb-2">Notes (optional):</label>
          <textarea id="note" name="note" rows="4" class="form-input resize-none" placeholder="What influenced your mood today? Any triggers or positive events?"></textarea>
        </div>

        <button type="submit" class="w-full btn-primary py-3 text-lg">
          <i class="fas fa-save mr-2"></i> Save Today's Mood
        </button>
      </form>
    </div>

    <!-- Mood Insights -->
    <div class="card">
      <h2 class="text-2xl font-bold text-textMain mb-6 flex items-center">
        <i class="fas fa-chart-line text-secondary mr-3"></i> Mood Insights
      </h2>
      <% if (Object.keys(moodCounts).length === 0) { %>
        <p class="text-gray-500">No mood data yet. Start tracking your mood to see insights.</p>
      <% } else { %>
        <h3 class="font-medium text-gray-700 mb-3">Mood Frequency:</h3>
        <ul class="space-y-2" id="moodInsightsList">
          <% for (const [mood, count] of Object.entries(moodCounts)) { %>
            <li class="flex justify-between items-center">
              <span><strong><%= mood %>:</strong></span>
              <span class="bg-primary/10 text-primary px-2 py-1 rounded text-sm"><%= count %> times</span>
            </li>
          <% } %>
        </ul>
      <% } %>
    </div>
  </div>

  <!-- Mood History -->
  <div class="card">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold text-textMain flex items-center">
        <i class="fas fa-history text-accent mr-3"></i> Mood History
      </h2>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-gray-200">
            <th class="text-left py-3 px-4 font-semibold text-textMain">Date</th>
            <th class="text-left py-3 px-4 font-semibold text-textMain">Mood</th>
            <th class="text-left py-3 px-4 font-semibold text-textMain">Energy</th>
            <th class="text-left py-3 px-4 font-semibold text-textMain">Notes</th>
          </tr>
        </thead>
        <tbody id="moodHistoryBody">
          <% if (entries.length === 0) { %>
            <tr id="noEntriesRow">
              <td colspan="4" class="text-center py-12 text-gray-500">
                No mood entries yet. Start tracking your mood to see your patterns over time.
              </td>
            </tr>
          <% } else { %>
            <% entries.forEach(entry => { %>
              <tr class="border-b border-gray-100 hover:bg-gray-50">
                <td class="py-3 px-4 text-sm">
                  <%= new Date(entry.entry_date).toLocaleDateString('en-US', { weekday:'short', month:'short', day:'numeric' }) %>
                </td>
                <td class="py-3 px-4">
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    <%= entry.mood %>
                  </span>
                </td>
                <td class="py-3 px-4">
                  <div class="flex items-center space-x-2">
                    <div class="relative w-24 bg-gray-200 rounded-full h-3">
                      <div class="absolute top-0 left-0 h-3 rounded-full energy-bar transition-all duration-300" 
                           data-energy="<%= entry.energy || 5 %>"style="width: <%= entry.energy ? ((entry.energy/10)*100).toFixed(0) : 50 %>%; background-color: <%= entry.energy <= 3 ? '#EF4444' : entry.energy <= 7 ? '#F59E0B' : '#10B981' %>;"></div>
                    </div>
                    <span class="text-xs text-gray-600"><%= entry.energy || 'N/A' %></span>
                  </div>
                </td>
                <td class="py-3 px-4 text-sm text-gray-600">
                  <%= entry.note || '-' %>
                </td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
/* Mood Card Selection Styles */
.mood-card {
  transition: all 0.2s ease-in-out;
}

.mood-option input:checked + .mood-card {
  transform: scale(1.05);
  border-width: 2px;
}

/* Happy - Yellow */
.mood-option:has(input[value="Happy"]:checked) .mood-card {
  border-color: #F59E0B !important;
  background-color: #FEF3C7 !important;
}

/* Calm - Green */
.mood-option:has(input[value="Calm"]:checked) .mood-card {
  border-color: #10B981 !important;
  background-color: #D1FAE5 !important;
}

/* Anxious - Orange */
.mood-option:has(input[value="Anxious"]:checked) .mood-card {
  border-color: #F97316 !important;
  background-color: #FED7AA !important;
}

/* Sad - Blue */
.mood-option:has(input[value="Sad"]:checked) .mood-card {
  border-color: #3B82F6 !important;
  background-color: #DBEAFE !important;
}

/* Angry - Red */
.mood-option:has(input[value="Angry"]:checked) .mood-card {
  border-color: #EF4444 !important;
  background-color: #FEE2E2 !important;
}

/* Neutral - Gray */
.mood-option:has(input[value="Neutral"]:checked) .mood-card {
  border-color: #6B7280 !important;
  background-color: #F3F4F6 !important;
}

/* Fallback for browsers that don't support :has() */
.mood-card.selected-happy {
  border-color: #F59E0B !important;
  background-color: #FEF3C7 !important;
  transform: scale(1.05);
}

.mood-card.selected-calm {
  border-color: #10B981 !important;
  background-color: #D1FAE5 !important;
  transform: scale(1.05);
}

.mood-card.selected-anxious {
  border-color: #F97316 !important;
  background-color: #FED7AA !important;
  transform: scale(1.05);
}

.mood-card.selected-sad {
  border-color: #3B82F6 !important;
  background-color: #DBEAFE !important;
  transform: scale(1.05);
}

.mood-card.selected-angry {
  border-color: #EF4444 !important;
  background-color: #FEE2E2 !important;
  transform: scale(1.05);
}

.mood-card.selected-neutral {
  border-color: #6B7280 !important;
  background-color: #F3F4F6 !important;
  transform: scale(1.05);
}

/* Energy Slider Styling */
.slider::-webkit-slider-thumb {
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #4DB6AC;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

.slider::-moz-range-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #4DB6AC;
  cursor: pointer;
  border: 2px solid white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* Energy bar colors */
.energy-bar.low { background-color: #EF4444; }
.energy-bar.medium { background-color: #F59E0B; }
.energy-bar.high { background-color: #10B981; }

/* Table row hover effect */
tbody tr:hover {
  background-color: #F9FAFB;
}

/* Improved responsive design */
@media (max-width: 768px) {
  .mood-card {
    padding: 0.75rem;
  }
  
  .mood-card .text-3xl {
    font-size: 1.5rem;
  }
  
  table {
    font-size: 0.875rem;
  }
}
</style>

