<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" data-user-authenticated="<%= user ? 'true' : 'false' %>">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-textMain mb-4">
            üë©‚Äç‚öïÔ∏è Find a Therapist
        </h1>
        <p class="text-xl text-gray-600">
            Connect with licensed mental health professionals who understand your needs
        </p>
    </div>

    <!-- Search and Filters -->
    <div class="bg-white rounded-xl shadow-md p-6 mb-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
                <label class="block text-sm font-medium text-textMain mb-2">Search</label>
                <input 
                    type="text" 
                    placeholder="Name or specialty..." 
                    class="form-input"
                    id="therapist-search"
                >
            </div>
            <div>
                <label class="block text-sm font-medium text-textMain mb-2">Specialty</label>
                <select class="form-input" id="specialty-filter">
                    <option value="">All Specialties</option>
                    <option value="anxiety">Anxiety & Depression</option>
                    <option value="cbt">Cognitive Behavioral Therapy</option>
                    <option value="trauma">Trauma & PTSD</option>
                    <option value="couples">Couples Therapy</option>
                    <option value="family">Family Therapy</option>
                    <option value="addiction">Addiction Counseling</option>
                    <option value="child">Child Psychology</option>
                    <option value="grief">Grief Counseling</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-textMain mb-2">Experience</label>
                <select class="form-input" id="experience-filter">
                    <option value="">Any Experience</option>
                    <option value="1-3">1-3 years</option>
                    <option value="4-7">4-7 years</option>
                    <option value="8-15">8-15 years</option>
                    <option value="15+">15+ years</option>
                </select>
            </div>
            <div class="flex items-end">
                <button class="btn-primary w-full" onclick="filterTherapists()">
                    <i class="fas fa-search mr-2"></i>Find Therapists
                </button>
            </div>
        </div>
    </div>

    <!-- Therapist Directory -->
    <div class="mb-12">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-textMain">Available Therapists</h2>
            <div class="text-sm text-gray-600">
                <span id="therapist-count"><%= approvedTherapists.length %></span> therapists available
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="therapists-grid">
            <% if (approvedTherapists && approvedTherapists.length > 0) { %>
                <% approvedTherapists.forEach(therapist => { %>
                <div class="card group hover:transform hover:scale-105 transition-all duration-300" 
                     data-specialty="<%= therapist.specialty %>" 
                     data-experience="<%= therapist.experience %>"
                     data-name="<%= therapist.name.toLowerCase() %>">
                    <div class="text-center mb-4">
                        <% if (therapist.profile_image) { %>
                            <img 
                                src="/uploads/<%= therapist.profile_image %>" 
                                alt="<%= therapist.name %>" 
                                class="w-24 h-24 rounded-full mx-auto mb-4 object-cover shadow-md"
                            >
                        <% } else { %>
                            <div class="w-24 h-24 rounded-full mx-auto mb-4 bg-primary/10 flex items-center justify-center shadow-md">
                                <i class="fas fa-user-md text-2xl text-primary"></i>
                            </div>
                        <% } %>
                        
                        <h3 class="text-xl font-bold text-textMain mb-1"><%= therapist.name %></h3>
                        <p class="text-primary font-medium mb-2 capitalize">
                            <%= therapist.specialty ? therapist.specialty.replace('-', ' & ').replace(/\b\w/g, l => l.toUpperCase()) : 'General Practice' %>
                        </p>
                        
                        <div class="flex items-center justify-center mb-3">
                            <div class="flex items-center">
                                <% for (let i = 0; i < 5; i++) { %>
                                    <i class="fas fa-star text-yellow-400 text-sm"></i>
                                <% } %>
                            </div>
                            <span class="ml-2 text-sm text-gray-600">5.0</span>
                        </div>
                    </div>
                    
                    <div class="space-y-2 mb-6">
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-graduation-cap text-primary mr-2"></i>
                            <span><%= therapist.experience %> years experience</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-video text-primary mr-2"></i>
                            <span>Video & In-person sessions</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-certificate text-primary mr-2"></i>
                            <span>Licensed Professional</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-clock text-primary mr-2"></i>
                            <span>Available today</span>
                        </div>
                    </div>
                    
                    <!-- Bio Preview -->
                    <% if (therapist.bio) { %>
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 line-clamp-3">
                            <%= therapist.bio.substring(0, 120) %><%= therapist.bio.length > 120 ? '...' : '' %>
                        </p>
                    </div>
                    <% } %>
                    
                    <div class="space-y-3">
                        <button class="w-full btn-primary group-hover:bg-primary/90 transition-colors duration-200" 
                                onclick="bookConsultation('<%= therapist.id %>', '<%= therapist.name %>')">
                            <i class="fas fa-calendar mr-2"></i>Schedule Consultation
                        </button>
                        <button class="w-full btn-secondary group-hover:bg-secondary/90 transition-colors duration-200"
                                onclick="startChat('<%= therapist.id %>', '<%= therapist.name %>')">
                            <i class="fas fa-comments mr-2"></i>Start Chat
                        </button>
                        <button class="w-full text-primary hover:text-primary/80 text-sm font-medium py-2"
                                onclick="viewProfile('<%= therapist.id %>')">
                            <i class="fas fa-user mr-2"></i>View Full Profile
                        </button>
                    </div>
                </div>
                <% }) %>
            <% } else { %>
                <div class="col-span-full text-center py-12">
                    <div class="w-24 h-24 bg-gray-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                        <i class="fas fa-user-md text-3xl text-gray-400"></i>
                    </div>
                    <h3 class="text-xl font-medium text-gray-600 mb-2">No Approved Therapists Yet</h3>
                    <p class="text-gray-500">
                        We're currently reviewing therapist applications. Check back soon!
                    </p>
                </div>
            <% } %>
        </div>
    </div>

    <!-- Emergency Resources -->
    <div class="bg-red-50 border border-red-200 rounded-xl p-6 mb-8">
        <h3 class="text-xl font-semibold text-red-800 mb-4 flex items-center">
            <i class="fas fa-exclamation-triangle text-red-600 mr-3"></i>
            Crisis Support - Available 24/7
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-white rounded-lg p-4 border border-red-200">
                <div class="flex items-center mb-2">
                    <i class="fas fa-phone text-red-600 mr-2"></i>
                    <strong class="text-red-800">Crisis Text Line</strong>
                </div>
                <p class="text-red-700">Text HOME to <strong>741741</strong></p>
            </div>
            <div class="bg-white rounded-lg p-4 border border-red-200">
                <div class="flex items-center mb-2">
                    <i class="fas fa-phone text-red-600 mr-2"></i>
                    <strong class="text-red-800">Suicide Prevention</strong>
                </div>
                <p class="text-red-700">Call <strong>988</strong></p>
            </div>
            <div class="bg-white rounded-lg p-4 border border-red-200">
                <div class="flex items-center mb-2">
                    <i class="fas fa-ambulance text-red-600 mr-2"></i>
                    <strong class="text-red-800">Emergency</strong>
                </div>
                <p class="text-red-700">Call <strong>911</strong></p>
            </div>
        </div>
    </div>

    <!-- How It Works -->
    <div class="bg-gradient-to-r from-primary to-secondary text-white rounded-xl p-8">
        <h2 class="text-2xl font-bold mb-6 text-center">How It Works</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="text-center">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-search text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">1. Find Your Therapist</h3>
                <p class="opacity-90">Browse our verified therapists and find one that matches your needs</p>
            </div>
            <div class="text-center">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-calendar text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">2. Schedule Session</h3>
                <p class="opacity-90">Book a consultation at a time that works for you</p>
            </div>
            <div class="text-center">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-comments text-2xl"></i>
                </div>
                <h3 class="text-lg font-semibold mb-2">3. Start Healing</h3>
                <p class="opacity-90">Begin your journey to better mental health with professional support</p>
            </div>
        </div>
    </div>
</div>

<!-- Booking Modal -->
<div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-md w-full p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-xl font-semibold">Book Consultation</h3>
            <button onclick="closeBookingModal()" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <p class="text-gray-600 mb-6">Schedule a consultation with <span id="therapistName" class="font-medium"></span></p>
        
        <form id="bookingForm" method="POST" action="/book-consultation">
            <input type="hidden" id="therapistId" name="therapistId">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Preferred Date</label>
                    <input type="date" class="form-input" id="preferredDate" name="preferredDate" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Preferred Time</label>
                    <select class="form-input" id="preferredTime" name="preferredTime" required>
                        <option value="">Select time</option>
                        <option value="09:00">9:00 AM</option>
                        <option value="10:00">10:00 AM</option>
                        <option value="11:00">11:00 AM</option>
                        <option value="14:00">2:00 PM</option>
                        <option value="15:00">3:00 PM</option>
                        <option value="16:00">4:00 PM</option>
                        <option value="17:00">5:00 PM</option>
                        <option value="18:00">6:00 PM</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Session Type</label>
                    <select class="form-input" id="sessionType" name="sessionType" required>
                        <option value="">Select session type</option>
                        <option value="video">Video Call</option>
                        <option value="in-person">In-Person</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Additional Notes (Optional)</label>
                    <textarea class="form-input" id="notes" name="notes" rows="3"
                             placeholder="Any specific concerns or preferences..."></textarea>
                </div>
            </div>
            <div class="flex space-x-3 mt-6">
                <button type="button" onclick="closeBookingModal()" class="btn-secondary flex-1">Cancel</button>
                <button type="submit" class="btn-primary flex-1">Book Now</button>
            </div>
        </form>
    </div>
</div>

<script>
// Get user authentication status from data attribute
const isUserAuthenticated = document.querySelector('.max-w-7xl').dataset.userAuthenticated === 'true';

let selectedTherapistId = null;

function filterTherapists() {
    const search = document.getElementById('therapist-search').value.toLowerCase();
    const specialty = document.getElementById('specialty-filter').value;
    const experience = document.getElementById('experience-filter').value;
    const therapistCards = document.querySelectorAll('#therapists-grid [data-specialty]');
    let visibleCount = 0;

    therapistCards.forEach(card => {
        const cardSpecialty = card.dataset.specialty;
        const cardExperience = card.dataset.experience;
        const cardName = card.dataset.name;
        
        const matchesSearch = !search || cardName.includes(search);
        const matchesSpecialty = !specialty || cardSpecialty === specialty;
        const matchesExperience = !experience || cardExperience === experience;
        
        if (matchesSearch && matchesSpecialty && matchesExperience) {
            card.style.display = 'block';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    document.getElementById('therapist-count').textContent = visibleCount;
}

function bookConsultation(therapistId, therapistName) {
    if (isUserAuthenticated) {
        selectedTherapistId = therapistId;
        document.getElementById('therapistId').value = therapistId;
        document.getElementById('therapistName').textContent = therapistName;
        document.getElementById('bookingModal').classList.remove('hidden');
        
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('preferredDate').min = today;
        document.getElementById('preferredDate').value = '';
        document.getElementById('preferredTime').value = '';
        document.getElementById('sessionType').value = '';
        document.getElementById('notes').value = '';
    } else {
        alert('Please login to book a consultation');
        window.location.href = '/login';
    }
}

function closeBookingModal() {
    document.getElementById('bookingModal').classList.add('hidden');
    selectedTherapistId = null;
}

function startChat(therapistId, therapistName) {
    if (isUserAuthenticated) {
        // Implement chat functionality
        alert(`Starting chat with ${therapistName}. This feature will be available soon!`);
    } else {
        alert('Please login to start a chat');
        window.location.href = '/login';
    }
}

function viewProfile(therapistId) {
    // Navigate to therapist profile page
    window.location.href = `/therapist/${therapistId}`;
}

// Handle form submission
document.getElementById('bookingForm').addEventListener('submit', function(e) {
    const date = document.getElementById('preferredDate').value;
    const time = document.getElementById('preferredTime').value;
    const sessionType = document.getElementById('sessionType').value;
    
    if (!date || !time || !sessionType) {
        e.preventDefault();
        alert('Please fill in all required fields');
        return;
    }
    
    // Check if date is not in the past
    const selectedDate = new Date(date);
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    if (selectedDate < today) {
        e.preventDefault();
        alert('Please select a future date');
        return;
    }
});

// Initialize filters on page load
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('therapist-search').addEventListener('input', filterTherapists);
    document.getElementById('specialty-filter').addEventListener('change', filterTherapists);
    document.getElementById('experience-filter').addEventListener('change', filterTherapists);
});
</script>