<!-- Mobile Therapist Navbar -->
<nav id="mobile-therapist-navbar" class="fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 shadow-sm md:hidden">
  <div class="flex items-center justify-between px-4 py-3">
    <!-- Logo and Menu Button -->
    <div class="flex items-center gap-3">
      <!-- Mobile Menu Toggle -->
      <button id="mobile-sidebar-toggle" class="p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors">
        <i class="fas fa-bars text-lg"></i>
      </button>

      <!-- Logo -->
      <div class="flex items-center gap-2">
        <img src="/images/logo.png" alt="Calmtunes Logo" class="w-8 h-8">
        <span class="text-lg font-bold text-gray-900">Calmtunes</span>
      </div>
    </div>

    <!-- User Profile & Actions -->
    <div class="flex items-center gap-2">
      <!-- Notifications -->
      <button class="p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors relative">
        <i class="fas fa-bell text-lg"></i>
        <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
      </button>

      <!-- User Profile Dropdown -->
      <div class="relative">
        <button id="mobile-profile-toggle" class="flex items-center gap-2 p-1 rounded-lg hover:bg-gray-100 transition-colors">
          <%
          let mobileNavbarProfileImage = null;
          if (typeof user !== 'undefined' && user && user.profile_image && user.profile_image.trim() !== '' && user.profile_image !== 'null') {
            mobileNavbarProfileImage = user.profile_image.startsWith('/')
              ? user.profile_image
              : '/uploads/profiles/' + user.profile_image;
          }
          %>
          <% if (mobileNavbarProfileImage) { %>
            <img src="<%= mobileNavbarProfileImage %>" alt="<%= user.name %>'s Profile"
                 class="w-8 h-8 rounded-full object-cover border-2 border-purple-200"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center" style="display: none;">
              <span class="text-purple-600 font-bold text-sm">
                <%= user.name ? user.name.charAt(0).toUpperCase() : 'T' %>
              </span>
            </div>
          <% } else { %>
            <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
              <span class="text-purple-600 font-bold text-sm">
                <%= user.name ? user.name.charAt(0).toUpperCase() : 'T' %>
              </span>
            </div>
          <% } %>
          <i class="fas fa-chevron-down text-xs text-gray-600"></i>
        </button>

        <!-- Mobile Profile Dropdown -->
        <div id="mobile-profile-dropdown" class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border opacity-0 invisible transition-all duration-200 transform translate-y-2">
          <div class="py-2">
            <!-- User Info Header -->
            <div class="px-4 py-3 border-b border-gray-100">
              <div class="font-medium text-gray-900"><%= user.name %></div>
              <div class="text-sm text-gray-500">Licensed Therapist</div>
            </div>

            <!-- Profile Links -->
            <a href="/account" class="block px-4 py-3 hover:bg-gray-50 transition-colors">
              <i class="fas fa-cog text-gray-600 mr-3"></i>
              <span class="text-gray-900">Account Settings</span>
            </a>
            <a href="/therapist/info" class="block px-4 py-3 hover:bg-gray-50 transition-colors">
              <i class="fas fa-user-md text-gray-600 mr-3"></i>
              <span class="text-gray-900">Therapist Profile</span>
            </a>

            <div class="border-t border-gray-100"></div>

            <a href="/logout" class="block px-4 py-3 text-red-600 hover:bg-red-50 transition-colors">
              <i class="fas fa-sign-out-alt mr-3"></i>Sign Out
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Mobile Sidebar Overlay -->
<div id="mobile-sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"></div>

<!-- Mobile Sidebar -->
<aside id="mobile-therapist-sidebar" class="fixed top-0 left-0 h-full w-80 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
  <!-- Mobile Sidebar Header -->
  <div class="flex items-center justify-between p-4 border-b border-gray-200">
    <div class="flex items-center gap-3">
      <img src="/images/logo.png" alt="Calmtunes Logo" class="w-8 h-8">
      <span class="text-lg font-bold text-gray-900">Therapist Menu</span>
    </div>
    <button id="mobile-sidebar-close" class="p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors">
      <i class="fas fa-times text-lg"></i>
    </button>
  </div>

  <!-- Mobile Sidebar Content -->
  <div class="flex-1 overflow-y-auto">
    <!-- Profile Section -->
    <div class="p-4 border-b border-gray-200">
      <div class="flex items-center gap-3">
        <%
        let mobileSidebarProfileImage = null;
        if (typeof user !== 'undefined' && user && user.profile_image && user.profile_image.trim() !== '' && user.profile_image !== 'null') {
          mobileSidebarProfileImage = user.profile_image.startsWith('/')
            ? user.profile_image
            : '/uploads/profiles/' + user.profile_image;
        }
        %>
        <% if (mobileSidebarProfileImage) { %>
          <img src="<%= mobileSidebarProfileImage %>" alt="<%= user.name %>'s Profile"
               class="w-12 h-12 rounded-full object-cover border-2 border-purple-200"
               onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
          <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center" style="display: none;">
            <span class="text-purple-600 font-bold text-lg">
              <%= user.name ? user.name.charAt(0).toUpperCase() : 'T' %>
            </span>
          </div>
        <% } else { %>
          <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
            <span class="text-purple-600 font-bold text-lg">
              <%= user.name ? user.name.charAt(0).toUpperCase() : 'T' %>
            </span>
          </div>
        <% } %>
        <div>
          <h3 class="font-bold text-gray-900 text-sm"><%= user.name %></h3>
          <p class="text-xs text-gray-500">Licensed Therapist</p>
        </div>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="p-4 space-y-2">
      <a href="/therapist"
         class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'dashboard') ? 'bg-purple-50 text-purple-700 border border-purple-200' : 'text-gray-700 hover:bg-gray-50' %>">
        <i class="fas fa-th-large w-5 h-5"></i>
        <span class="font-medium">Dashboard</span>
      </a>

      <a href="/therapist/patients"
         class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'patients') ? 'bg-purple-50 text-purple-700 border border-purple-200' : 'text-gray-700 hover:bg-gray-50' %>">
        <i class="fas fa-users w-5 h-5"></i>
        <span class="font-medium">Patients</span>
      </a>

      <a href="/therapist/schedule"
         class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'schedule') ? 'bg-purple-50 text-purple-700 border border-purple-200' : 'text-gray-700 hover:bg-gray-50' %>">
        <i class="fas fa-calendar-alt w-5 h-5"></i>
        <span class="font-medium">Schedule</span>
      </a>

      <a href="/therapist/chat"
         class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'chat') ? 'bg-purple-50 text-purple-700 border border-purple-200' : 'text-gray-700 hover:bg-gray-50' %>">
        <i class="fas fa-comments w-5 h-5"></i>
        <span class="font-medium">Messages</span>
      </a>

      <a href="/therapist/resources"
         class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'resources') ? 'bg-purple-50 text-purple-700 border border-purple-200' : 'text-gray-700 hover:bg-gray-50' %>">
        <i class="fas fa-book w-5 h-5"></i>
        <span class="font-medium">Resources</span>
      </a>
    </nav>

    <!-- Bottom Section -->
    <div class="p-4 border-t border-gray-200 space-y-2">
      <a href="/account"
         class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
        <i class="fas fa-cog w-5 h-5"></i>
        <span class="font-medium">Settings</span>
      </a>
      <a href="/logout"
         class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors">
        <i class="fas fa-sign-out-alt w-5 h-5"></i>
        <span class="font-medium">Logout</span>
      </a>
    </div>
  </div>
</aside>

<!-- Mobile Navigation JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const mobileSidebarToggle = document.getElementById('mobile-sidebar-toggle');
  const mobileSidebarClose = document.getElementById('mobile-sidebar-close');
  const mobileSidebarOverlay = document.getElementById('mobile-sidebar-overlay');
  const mobileTherapistSidebar = document.getElementById('mobile-therapist-sidebar');
  const mobileProfileToggle = document.getElementById('mobile-profile-toggle');
  const mobileProfileDropdown = document.getElementById('mobile-profile-dropdown');

  // Mobile sidebar toggle
  if (mobileSidebarToggle) {
    mobileSidebarToggle.addEventListener('click', function() {
      mobileTherapistSidebar.classList.remove('-translate-x-full');
      mobileSidebarOverlay.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    });
  }

  // Mobile sidebar close
  function closeMobileSidebar() {
    mobileTherapistSidebar.classList.add('-translate-x-full');
    mobileSidebarOverlay.classList.add('hidden');
    document.body.style.overflow = '';
  }

  if (mobileSidebarClose) {
    mobileSidebarClose.addEventListener('click', closeMobileSidebar);
  }

  if (mobileSidebarOverlay) {
    mobileSidebarOverlay.addEventListener('click', closeMobileSidebar);
  }

  // Mobile profile dropdown toggle
  if (mobileProfileToggle) {
    mobileProfileToggle.addEventListener('click', function(e) {
      e.stopPropagation();
      const isVisible = !mobileProfileDropdown.classList.contains('invisible');

      if (isVisible) {
        mobileProfileDropdown.classList.add('opacity-0', 'invisible');
        mobileProfileDropdown.classList.remove('opacity-100', 'visible');
      } else {
        mobileProfileDropdown.classList.remove('opacity-0', 'invisible');
        mobileProfileDropdown.classList.add('opacity-100', 'visible');
      }
    });
  }

  // Close mobile profile dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (mobileProfileDropdown && !mobileProfileToggle.contains(e.target) && !mobileProfileDropdown.contains(e.target)) {
      mobileProfileDropdown.classList.add('opacity-0', 'invisible');
      mobileProfileDropdown.classList.remove('opacity-100', 'visible');
    }
  });

  // Close mobile sidebar on window resize to desktop
  window.addEventListener('resize', function() {
    if (window.innerWidth >= 768) {
      closeMobileSidebar();
      if (mobileProfileDropdown) {
        mobileProfileDropdown.classList.add('opacity-0', 'invisible');
        mobileProfileDropdown.classList.remove('opacity-100', 'visible');
      }
    }
  });
});
</script>

<style>
/* Mobile navigation styles */
.mobile-nav-item {
  transition: all 0.2s ease;
}

.mobile-nav-item:hover {
  transform: translateX(2px);
}

/* Ensure mobile navbar doesn't interfere with content */
body.mobile-nav-open {
  overflow: hidden;
}

/* Mobile sidebar animations */
#mobile-therapist-sidebar {
  transition: transform 0.3s ease-in-out;
}

/* Mobile profile dropdown animations */
#mobile-profile-dropdown {
  transition: all 0.2s ease-in-out;
}
</style>