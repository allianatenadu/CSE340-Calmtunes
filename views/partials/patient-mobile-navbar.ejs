<!-- Mobile Patient Navbar -->
<nav
  id="mobile-patient-navbar"
  class="fixed top-0 left-0 right-0 z-50 bg-white border-b border-gray-200 shadow-sm md:hidden"
>
  <div class="flex items-center justify-between px-3 sm:px-4 py-2 sm:py-3">
    <!-- Logo and Menu Button -->
    <div class="flex items-center gap-2 sm:gap-3">
      <!-- Mobile Menu Toggle -->
      <button
        id="mobile-patient-sidebar-toggle"
        class="p-1.5 sm:p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors"
      >
        <i class="fas fa-bars text-base sm:text-lg"></i>
      </button>

      <!-- Logo -->
      <div class="flex items-center gap-2">
        <img src="/images/logo.png" alt="Calmtunes Logo" class="w-7 h-7 sm:w-8 sm:h-8" />
        <span class="text-base sm:text-lg font-bold text-gray-900">Calmtunes</span>
      </div>
    </div>

    <!-- User Profile & Actions -->
    <div class="flex items-center gap-1 sm:gap-2">
      <!-- Notifications -->
      <button
        class="p-1.5 sm:p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors relative"
      >
        <i class="fas fa-bell text-base sm:text-lg"></i>
        <span
          class="absolute -top-1 -right-1 w-2.5 h-2.5 sm:w-3 sm:h-3 bg-red-500 rounded-full"
        ></span>
      </button>

      <!-- User Profile Dropdown -->
      <div class="relative">
        <button
          id="mobile-patient-profile-toggle"
          class="flex items-center gap-1 sm:gap-2 p-0.5 sm:p-1 rounded-lg hover:bg-gray-100 transition-colors"
        >
          <% if (typeof profileImageUrl !== 'undefined' && profileImageUrl) { %>
          <img
            src="<%= profileImageUrl %>"
            alt="<%= user.name %>'s Profile"
            class="w-7 h-7 sm:w-8 sm:h-8 rounded-full object-cover border-2 border-blue-200"
          />
          <% } else { %>
          <div
            class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-blue-100 flex items-center justify-center"
          >
            <span class="text-blue-600 font-bold text-xs sm:text-sm">
              <%= user.name ? user.name.charAt(0).toUpperCase() : 'P' %>
            </span>
          </div>
          <% } %>
          <i class="fas fa-chevron-down text-xs text-gray-600"></i>
        </button>

        <!-- Mobile Profile Dropdown -->
        <div
          id="mobile-patient-profile-dropdown"
          class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border opacity-0 invisible transition-all duration-200 transform translate-y-2"
        >
          <div class="py-2">
            <!-- User Info Header -->
            <div class="px-4 py-3 border-b border-gray-100">
              <div class="font-medium text-gray-900"><%= user.name %></div>
              <div class="text-sm text-gray-500">Patient</div>
            </div>

            <!-- Profile Links -->
            <a
              href="/account"
              class="block px-4 py-3 hover:bg-gray-50 transition-colors"
            >
              <i class="fas fa-cog text-gray-600 mr-3"></i>
              <span class="text-gray-900">Account Settings</span>
            </a>
            <a
              href="/my-therapist"
              class="block px-4 py-3 hover:bg-gray-50 transition-colors"
            >
              <i class="fas fa-user-md text-gray-600 mr-3"></i>
              <span class="text-gray-900">My Therapist</span>
            </a>

            <div class="border-t border-gray-100"></div>

            <a
              href="/logout"
              class="block px-4 py-3 text-red-600 hover:bg-red-50 transition-colors"
            >
              <i class="fas fa-sign-out-alt mr-3"></i>Sign Out
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Mobile Patient Sidebar Overlay -->
<div
  id="mobile-patient-sidebar-overlay"
  class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"
></div>

<!-- Mobile Patient Sidebar -->
<aside
  id="mobile-patient-sidebar"
  class="fixed top-0 left-0 h-full w-72 sm:w-80 bg-white shadow-xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden"
>
  <!-- Mobile Sidebar Header -->
  <div class="flex items-center justify-between p-3 sm:p-4 border-b border-gray-200">
    <div class="flex items-center gap-2 sm:gap-3">
      <img src="/images/logo.png" alt="Calmtunes Logo" class="w-7 h-7 sm:w-8 sm:h-8" />
      <span class="text-base sm:text-lg font-bold text-gray-900">Patient Menu</span>
    </div>
    <button
      id="mobile-patient-sidebar-close"
      class="p-1.5 sm:p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors"
    >
      <i class="fas fa-times text-base sm:text-lg"></i>
    </button>
  </div>

  <!-- Mobile Sidebar Content -->
  <div class="flex-1 overflow-y-auto">
    <!-- Profile Section -->
    <div class="p-3 sm:p-4 border-b border-gray-200">
      <div class="flex items-center gap-2 sm:gap-3">
        <% if (typeof profileImageUrl !== 'undefined' && profileImageUrl) { %>
        <img
          src="<%= profileImageUrl %>"
          alt="<%= user.name %>'s Profile"
          class="w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover border-2 border-blue-200"
        />
        <% } else { %>
        <div
          class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-100 flex items-center justify-center"
        >
          <span class="text-blue-600 font-bold text-base sm:text-lg">
            <%= user.name ? user.name.charAt(0).toUpperCase() : 'P' %>
          </span>
        </div>
        <% } %>
        <div class="min-w-0 flex-1">
          <h3 class="font-bold text-gray-900 text-xs sm:text-sm truncate"><%= user.name %></h3>
          <p class="text-xs text-gray-500">Patient</p>
        </div>
      </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="p-3 sm:p-4 space-y-1 sm:space-y-2">
      <a
        href="/dashboard"
        class="mobile-nav-item flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'dashboard') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-home w-4 h-4 sm:w-5 sm:h-5"></i>
        <span class="font-medium text-sm sm:text-base">Dashboard</span>
      </a>

      <a
        href="/music"
        class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'music') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-music w-5 h-5"></i>
        <span class="font-medium">Music Library</span>
      </a>

      <a
        href="/mood-tracker"
        class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'mood-tracker') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-chart-bar w-5 h-5"></i>
        <span class="font-medium">Mood Tracking</span>
      </a>

      <a
        href="/drawing"
        class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'drawing') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-palette w-5 h-5"></i>
        <span class="font-medium">Art Work</span>
      </a>

      <a
        href="/panic"
        class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'panic') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-shield-alt w-5 h-5"></i>
        <span class="font-medium">Panic Relief</span>
      </a>

      <a
        href="/find-therapist"
        class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'find-therapist') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-search w-5 h-5"></i>
        <span class="font-medium">Find Therapist</span>
      </a>

      <a
        href="/chat"
        class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'my-therapist') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-user-md w-5 h-5"></i>
        <span class="font-medium">  Messages</span>
      </a>

      <a
        href="/appointments"
        class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'appointments') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-calendar-plus w-5 h-5"></i>
        <span class="font-medium">Book Session</span>
      </a>

      <a
        href="/notifications"
        class="mobile-nav-item flex items-center gap-3 px-4 py-3 rounded-lg transition-colors <%= (typeof currentPage !== 'undefined' && currentPage === 'notifications') ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-700 hover:bg-gray-50' %>"
      >
        <i class="fas fa-bell w-5 h-5"></i>
        <span class="font-medium">Notifications</span>
      </a>
    </nav>

    <!-- Bottom Section -->
    <div class="p-3 sm:p-4 border-t border-gray-200 space-y-1 sm:space-y-2">
      <a
        href="/account"
        class="mobile-nav-item flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"
      >
        <i class="fas fa-cog w-4 h-4 sm:w-5 sm:h-5"></i>
        <span class="font-medium text-sm sm:text-base">Settings</span>
      </a>
      <a
        href="/logout"
        class="mobile-nav-item flex items-center gap-2 sm:gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors"
      >
        <i class="fas fa-sign-out-alt w-4 h-4 sm:w-5 sm:h-5"></i>
        <span class="font-medium text-sm sm:text-base">Logout</span>
      </a>
    </div>
  </div>
</aside>

<!-- Mobile Patient Navigation JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const mobileSidebarToggle = document.getElementById(
      "mobile-patient-sidebar-toggle"
    );
    const mobileSidebarClose = document.getElementById(
      "mobile-patient-sidebar-close"
    );
    const mobileSidebarOverlay = document.getElementById(
      "mobile-patient-sidebar-overlay"
    );
    const mobilePatientSidebar = document.getElementById(
      "mobile-patient-sidebar"
    );
    const mobileProfileToggle = document.getElementById(
      "mobile-patient-profile-toggle"
    );
    const mobileProfileDropdown = document.getElementById(
      "mobile-patient-profile-dropdown"
    );

    // Mobile sidebar toggle
    if (mobileSidebarToggle) {
      mobileSidebarToggle.addEventListener("click", function () {
        mobilePatientSidebar.classList.remove("-translate-x-full");
        mobileSidebarOverlay.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      });
    }

    // Mobile sidebar close
    function closeMobileSidebar() {
      mobilePatientSidebar.classList.add("-translate-x-full");
      mobileSidebarOverlay.classList.add("hidden");
      document.body.style.overflow = "";
    }

    if (mobileSidebarClose) {
      mobileSidebarClose.addEventListener("click", closeMobileSidebar);
    }

    if (mobileSidebarOverlay) {
      mobileSidebarOverlay.addEventListener("click", closeMobileSidebar);
    }

    // Mobile profile dropdown toggle
    if (mobileProfileToggle) {
      mobileProfileToggle.addEventListener("click", function (e) {
        e.stopPropagation();
        const isVisible =
          !mobileProfileDropdown.classList.contains("invisible");

        if (isVisible) {
          mobileProfileDropdown.classList.add("opacity-0", "invisible");
          mobileProfileDropdown.classList.remove("opacity-100", "visible");
        } else {
          mobileProfileDropdown.classList.remove("opacity-0", "invisible");
          mobileProfileDropdown.classList.add("opacity-100", "visible");
        }
      });
    }

    // Close mobile profile dropdown when clicking outside
    document.addEventListener("click", function (e) {
      if (
        mobileProfileDropdown &&
        !mobileProfileToggle.contains(e.target) &&
        !mobileProfileDropdown.contains(e.target)
      ) {
        mobileProfileDropdown.classList.add("opacity-0", "invisible");
        mobileProfileDropdown.classList.remove("opacity-100", "visible");
      }
    });

    // Close mobile sidebar on window resize to desktop
    window.addEventListener("resize", function () {
      if (window.innerWidth >= 768) {
        closeMobileSidebar();
        if (mobileProfileDropdown) {
          mobileProfileDropdown.classList.add("opacity-0", "invisible");
          mobileProfileDropdown.classList.remove("opacity-100", "visible");
        }
      }
    });
  });
</script>

<style>
  /* Mobile navigation styles */
  .mobile-nav-item {
    transition: all 0.2s ease;
  }

  .mobile-nav-item:hover {
    transform: translateX(2px);
  }

  /* Ensure mobile navbar doesn't interfere with content */
  body.mobile-nav-open {
    overflow: hidden;
  }

  /* Mobile sidebar animations */
  #mobile-patient-sidebar {
    transition: transform 0.3s ease-in-out;
  }

  /* Mobile profile dropdown animations */
  #mobile-patient-profile-dropdown {
    transition: all 0.2s ease-in-out;
  }
</style>
